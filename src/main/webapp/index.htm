<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-GB">
<head>
<title>Welcome to Technopark</title>
<link rel="icon" href="./images/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
<meta http-equiv="Content-Type"	content="application/xhtml+xml; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="./css/screen.css" media="screen" />
<link rel="stylesheet" type="text/css" href="./css/form.css" media="screen" />
<link rel="stylesheet" type="text/css" href="./css/print.css" media="print" />
<link rel="stylesheet" href="./css/jquery-ui.css" type="text/css" />
<script src="./js/jquery-1.10.2.min.js"></script>
<script src="./js/jquery-ui.js"></script>
<script type="text/javascript" src="./js/jquery-barcode.min.js"></script>
<script type="text/javascript" src="./js/tpark.js"></script>
</head>
<body>
	<table class="headerclass" border="0" width="100%">
	<tr>
	<td width="3%"></td> 
	<td width="100%"><img src="./images/header-1.png"></img></td>
	</tr>
	</table>
	<br>
	<div class="menu3">
    <a href="." class="current">Home</a>
    <a href="./search.htm">Search</a>
    <a href="http://technopark.org/company-a-z-listing" target="_blank" >Companies A-Z Listing</a>
    </div>
<div class="menu3sub"> </div>
 	<div class="colmask blogstyle">
		<div class="colmid">
			<div class="colleft">
				<div class="col1">
					<center><b><font color="red"><span class="message"></span></font></b></center>
					<form id="signup" method="post">
							<fieldset>
							<legend>Enter Details</legend>
							<ol>
								<li>
								<table border="0">
								<tr>
								<td><label for="picture">Guest Photo</label></td>
								<td><video id="video" width="150" height="150"></video></td>
								<td align="bottom">								
								<input type="submit" id="takepic" value="Take Picture" />
								</td>
							 	<td><div id="canvasHolder"></div></td>
								</tr>
								</table>
								</li>
								<li><label for="firstName">First Name *</label> 
									<input type="text" id="firstName" name="firstName"
									placeholder="First Name" class="firstName" required /></li>
									
								<li><label for="purpose">Purpose of Visit *</label> <input
									type="text" id="purpose" name="purpose"
									placeholder="Purpose" class="purpose" required /></li>
									
									<li><label for="mobile">Mobile *</label> <input type="mobile"
									id="mobile" name="mobile" pattern="\d{10}"
									placeholder="Please enter a ten digit phone number" class="mobile" 
									 />
									<p class="validation01">
										<span class="invalid">No spaces or brackets e.g.
											9999999999</span> <span class="valid">Your mobile number is
											valid</span>
									</p></li>
								
								<li><label for="companion">Visitors Accompanying </label>
								<INPUT id="accompanyCount"  name="accompanyCount" class= "accompanyCount" TYPE="NUMBER" MIN="0" MAX="10" STEP="1" VALUE="0" SIZE="6"></INPUT></li>
								
							<!-- 	<li><label for="accname">Accompany Name</label> <input
									type="text" id="accompanyName" name="accompanyName"
									placeholder="Companion Name" class="accname" /></li>
							 -->	
								
								<li><label for="company">Company</label> 
								<input type="text"	name="company" id="company" class="company" /></li>
								
								<li><label for="building">Building</label> <select
									name="building" id="building" class="building">
									</select></li>
								
								<li><label for="vechno">Vehicle No</label> 
										<input
									type="text" id="vechno" name="vechno"
									placeholder="Vehicle No" class="vechno" /></li>
									
									<li><label for="photoid">Photo Id Number</label> <input
									type="text" id="photoId" name="photoId"
									placeholder="Photo Id Number" class="personid" />
								<select
									name="photoIdType" id="photoIdType" class="personidselect">
										<option>Voter Id</option>
										<option>Aadhar</option>
										<option>License</option>
										<option>Other</option>
								</select>
									
									</li>
								
							<!-- 	<li><label for="email">Email </label> <input type="email"
									id="email" name="email" class="email"
									title="Please enter a valid email" />
									<p class="validation01">
										<span class="invalid">Please enter a valid email
											address e.g. someone@tpark.org</span> <span class="valid">Your
											email address is now valid</span>
									</p></li> -->
									
									<li><label for="validity">Pass Valid for (hours)</label>
									<INPUT id="validity" name="validity" class="validupto" 
									TYPE="number" MIN="0" MAX="8" STEP="1" VALUE="2" SIZE="6">
									</INPUT></li>
							</ol>							
						</fieldset>
						<input type="hidden" name="imageencodestr" id="imageencodestr" />
						<input type="submit" id="save" class="save" value="Save" />								
						<!-- <h5>Fields marked (*) are required</h5> -->
					</form>
						<input type="submit" id="next" class="save" value="Clear" />
					
				</div>
				<div class="col3">
				<div id="preview">
					<fieldset >
						<legend  id="previewlgnd">Preview Pass</legend>
						<img id="icon" src="./images/logo.jpg"  width="100" height="100"/><br>
						<img id="vpreview" src="" width="150" height="150" />
						 <br /> 
						 No:<span class="passid_preview"></span> <br /> 
						 Name:<span class="firstname_preview"></span><span class="accmpny_cnt_preview"></span> <br /> 
						 Purpose:<span class="purpose_preview"></span> <br /> 
						 Mobile:<span class="tel_preview"></span><br />
						 Company:<span class="company_preview"></span><br /> 
						 Building:<span class="building_preview"></span><br />
						 Vehicle No:<span class="vechno_preview"></span><br />
						 Issued On:<span class="date"></span><br />
						 Time In:<span class="time"></span><br />
						 Valid for (Hours):<span class="validupto_preview"></span><br />
						<!--  <div id="bcTarget"></div>  -->
						</br>
						 
						<input type="submit" id="print" value="Print" onclick="window.print()" disabled="disabled" />
					</fieldset>					 
					</div>
				</div>				
			</div>
		</div>
	</div>
	<div id="footer" class="footer"><center><p>Works ONLY in Chrome/FireFox at 1024 x	768</p></center></div>


<script>
/**
 * Init functions to read the values from a file
 * For building and companies
 * 
 * */
jQuery.get('building.txt', function(data) {
	var lines = data.split('\n');
	$.each(lines, function() {
		$("#building").append($("<option>").attr("value", this).text(this));
	});
});
jQuery.get('companies.txt', function(data) {
	var lines = data.split('\n');
	$(".company").autocomplete({
		source : lines
	});
});

/**
 * Video Related functions
 ***/
var video;
var dataURL;
function setup() {

	navigator.myGetMedia = (navigator.getUserMedia
			|| navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia);
	navigator.myGetMedia({
		video : true
	}, connect, error);
}

function connect(stream) {
	video = document.getElementById("video");
	video.src = window.URL ? window.URL.createObjectURL(stream) : stream;
	video.play();
}

function error(e) {
	console.log(e);
}

addEventListener("load", setup);




/**
 * Function to capture the image
 * */
function captureImage() {
	var canvas = document.createElement('canvas');
	canvas.id = 'hiddenCanvas';
	// add canvas to the body element
	document.body.appendChild(canvas);
	// add canvas to #canvasHolder
	document.getElementById('canvasHolder').appendChild(canvas);
	var ctx = canvas.getContext('2d');
	canvas.width = video.videoWidth / 6;
	canvas.height = video.videoHeight / 4;
	ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
	// save canvas image as data url
	dataURL = canvas.toDataURL();
	// set preview image src to dataURL
	document.getElementById('vpreview').src = dataURL;
	// place the image value in the text box
	document.getElementById('imageencodestr').value = dataURL;

}


/**
 * AJAX call to REST Service
 * */

$("#signup").submit(
		function(event) {

			var formJqObj = $("#signup");
			var formDataObj = {};
			(function() {
				formJqObj.find(":input").not("[type='submit']").not(
						"[type='reset']").each(function() {
					var thisInput = $(this);
					formDataObj[thisInput.attr("name")] = thisInput.val();
				});
			})();
			console.log('' + JSON.stringify(formDataObj))
			$.ajax({
				type : "POST",
				url : "/visitormanagment/api/visitor/save",
				data : JSON.stringify(formDataObj),
				contentType : "application/json",

			}).done(
					function(data, textStatus, jqXHR) {
						$(".message").html("Pass Issued ");
						$(".passid_preview").html(data);
						var d = new Date();
						var strDate = d.getDate() + "/" + (d.getMonth() + 1)
								+ "/" + d.getFullYear();
						$(".date").html(strDate);
						var minutes = d.getMinutes();
						minutes = minutes > 9 ? minutes : '0' + minutes;
						$(".time").html(d.getHours() + ":" + minutes);
						$(".validupto_preview").html($(".validupto").val());
						if($(".accompanyCount").val() != "0")
							$(".accmpny_cnt_preview").html(" (+) "+$(".accompanyCount").val());
						// **Bar Code rmeoved for now
						// genBarCode();
		
						document.getElementById("print").disabled=false;
						
						document.getElementById("signup").reset();

						console.log("Ajax completed: " + data);
					}).fail(
					function(jqXHR, textStatus, errorThrown) {
						$(".message").html("Service Un Available ");
						console.log("Ajax problem: " + textStatus + ". "
								+ errorThrown);
					});
			event.preventDefault();
		});

// Bind a click to a button to capture an image from the video stream
var el = document.getElementById("takepic");
el.addEventListener("click", captureImage, false);

// Bind a click to a button to capture an image from the video stream
var el = document.getElementById("next");
el.addEventListener("click", clear, false);

// Bind a click to a button to capture an image from the video stream
var el = document.getElementById("save");
el.addEventListener("click", save, false);



</script>
</body>
</html>
